<!DOCTYPE HTML>
<html>
	<head>
		<title>Croak & Cram</title>
	</head>
	<body>
		<div class="flex-container">
			<div class="left">
				<img class="logo" src="./cc_logo.png" alt="" />
			</div>
			<div class="right">
				<h1>Tasks: Write To-Dos</h1>
				<div id="tasks"></div>
				<input id="write-task-box" type="text" onkeydown="onTextboxEdit(this)">
			</div>
		</div>
	</body>

	<style>
		@import url('https://fonts.googleapis.com/css2?family=Neucha&display=swap');
		:root {
			background-color: #91BA8D;
			font-family: "Neucha", cursive;
		}
		.flex-container {
			display: flex;
			flex-flow: row wrap;
			width: 100%;
			justify-content: space-evenly;
			align-items: center;
		}
		.left {
			flex: 10%;
			margin: 2rem;
		}
		.right {
			flex: 30%;
		}
		.logo {
			max-width: 100%;
		}
		.task-item {
			font-size: 2rem;
		}
		#write-task-box {
			padding: 0.5rem;
			font-family: "Neucha", cursive;
			font-size: 2rem;
			width: 80%;
		}
	</style>
	<script>
		let counter = 0;
		let allTasksList = [];

		if (localStorage.hasOwnProperty('allTasksList')) {
			let savedTasksList = JSON.parse(localStorage.getItem('allTasksList'));
			for (let i = 0; i < savedTasksList.length; i++) {
				let task = savedTasksList[i];
				add_task(task['task']);
				let taskDiv = document.getElementById("task" + i);
				if (task['checked']) {
					taskDiv.style.textDecoration = 'line-through';
					document.getElementById("checkbox" + i).checked = true;
				}
				else {
					taskDiv.style.textDecoration = 'none';
				}
				allTasksList.push(task);
				localStorage.setItem("allTasksList", JSON.stringify(allTasksList));
			}
		}

		function onTextboxEdit(content) {
			if (event.key === 'Enter') {
				add_task(content.value);

				allTasksList.push({'task': content.value, 'checked': false});
				localStorage.setItem("allTasksList", JSON.stringify(allTasksList));

				let taskTextbox = document.getElementById('write-task-box');
				taskTextbox.value = "";
			}
		}

		function add_task(taskDescription) {
			let taskDiv = document.createElement('div');
			taskDiv.className = "task-item";
			taskDiv.id = "task" + counter;
			let taskContent = document.createTextNode(taskDescription);
			let checkbox = document.createElement('input');
			checkbox.type = "checkbox";
			checkbox.addEventListener("click", remove_task);
			checkbox.id = "checkbox" + counter;
			taskDiv.appendChild(checkbox);
			taskDiv.appendChild(taskContent);

			let tasks = document.getElementById('tasks');
			tasks.append(taskDiv);
			counter++;
		}

		function remove_task(event) {
			let checkboxId = event.srcElement.id;
			let idNumber = checkboxId.replace("checkbox", "");
			let taskId = "task" + idNumber;
			let taskDiv = document.getElementById(taskId);

			let checkbox = document.getElementById(checkboxId);

			if (checkbox.checked) {
				taskDiv.style.textDecoration = 'line-through';
				allTasksList[idNumber].checked = true;
			}
			else {
				taskDiv.style.textDecoration = 'none';
				allTasksList[idNumber].checked = true;
			}
			localStorage.setItem("allTasksList", JSON.stringify(allTasksList));
		}
	</script>
</html>
